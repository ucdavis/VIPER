@using Viper.Areas.Effort.EmailTemplates.Models
@model VerificationReminderViewModel
@{
    Layout = "/EmailTemplates/Views/Shared/_EmailLayout.cshtml";
    ViewBag.Title = "Effort Verification Request";
    ViewBag.BaseUrl = Model.BaseUrl;
}

@* Title and term date range *@
<tr>
    <td class="email-content" style="padding: 20px 20px 0 20px;">
        <h1 style="margin: 0; padding: 0; color: #022851; font-size: 22px;">Effort Verification Request</h1>
        <p style="margin: 8px 0 0 0; padding: 0; color: #666666; font-size: 14px;">
            @Model.TermDescription
            @if (Model.TermStartDate.HasValue && Model.TermEndDate.HasValue)
            {
                <span>(@Model.TermStartDate.Value.ToString("MMMM d, yyyy") to @Model.TermEndDate.Value.ToString("MMMM d, yyyy"))</span>
            }
        </p>
    </td>
</tr>

@* No-effort messaging when instructor has no records *@
@if (Model.HasNoRecords)
{
    <tr>
        <td class="email-content section" style="padding: 20px;">
            <p class="section" style="margin: 0; padding: 0 0 10px 0;">It is appreciated if you reply by <strong>@Model.ReplyByDate</strong>.</p>
            <p class="section" style="margin: 0; padding: 0 0 10px 0;">Our records show you have <strong>no teaching effort recorded</strong> for @Model.TermDescription.</p>
            <p class="section" style="margin: 0; padding: 0;">If this is correct, please verify your "no effort" status using the link below. If you believe you should have effort recorded for this term, please reply to this message with corrections.</p>
        </td>
    </tr>
    <tr>
        <td class="email-content section" align="center" style="padding: 20px;">
            @* Use table-based button for maximum Outlook compatibility *@
            <table cellpadding="0" cellspacing="0" border="0" align="center">
                <tr>
                    <td bgcolor="#022851" style="background-color: #022851; padding: 12px 24px;">
                        <a href="@Model.VerificationUrl" style="color: #ffffff; font-weight: bold; text-decoration: none;">Verify No Effort</a>
                    </td>
                </tr>
            </table>
            <p class="section" style="margin: 0; padding: 15px 0 0 0; font-size: 13px; color: #666666;">If there are inaccuracies, please reply to this message with corrections.</p>
        </td>
    </tr>
}
else
{
@* Intro Section *@
<tr>
    <td class="email-content section" style="padding: 20px;">
        <p class="section" style="margin: 0; padding: 0 0 10px 0;">It is appreciated if you reply by <strong>@Model.ReplyByDate</strong>.</p>
        <p class="section" style="margin: 0; padding: 0;">Your effort data for @Model.TermDescription has been imported from CREST and Banner. Please check the data below for accuracy and/or missing effort. This includes graduate courses.</p>
    </td>
</tr>

@* Effort Records Table (non-R-courses) *@
@if (Model.Courses.Any(c => !c.IsRCourse))
{
<tr>
    <td class="email-content" style="padding: 0 20px 20px 20px;">
        <table class="data-table section" cellpadding="0" cellspacing="0" border="1" bordercolor="#dee2e6" width="100%" style="border: 1px solid #dee2e6; border-collapse: collapse;">
            <tr bgcolor="#022851" style="background-color: #022851;">
                <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Course</th>
                <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Units</th>
                <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Enrollment</th>
                <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Role</th>
            </tr>
            @foreach (var course in Model.Courses.Where(c => !c.IsRCourse))
            {
                @* Course Header Row *@
                <tr bgcolor="#f8f9fa" style="background-color: #f8f9fa;">
                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; font-weight: bold;">@course.CourseCode</td>
                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">@course.Units units</td>
                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">@course.Enrollment</td>
                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">@course.Role</td>
                </tr>
                @* Effort Line Items *@
                @foreach (var item in course.EffortItems)
                {
                    var style = item.IsZero
                        ? "padding: 8px 10px 8px 30px; border-bottom: 1px solid #dee2e6; color: #dc3545; font-weight: bold;"
                        : "padding: 8px 10px 8px 30px; border-bottom: 1px solid #dee2e6;";
                    <tr>
                        <td colspan="4" style="@style">
                            @item.EffortType = @item.Value
                            @if (item.IsZero)
                            {
                                <span style="color: #dc3545;">*** ZERO @item.Unit ***</span>
                            }
                            else
                            {
                                @item.Unit
                            }
                        </td>
                    </tr>
                }
            }
        </table>
    </td>
</tr>
}

@* R-Course Section (Resident Teaching) *@
@if (Model.Courses.Any(c => c.IsRCourse))
{
    <tr>
        <td class="email-content" style="padding: 0 20px 10px 20px;">
            <h3 style="margin: 0; padding: 0 0 10px 0; color: #022851; font-size: 16px;">Resident Teaching (R-Course)</h3>
            @if (Model.HasGenericRCourseWithZeroEffort)
            {
                <table cellpadding="0" cellspacing="0" border="0" width="100%" bgcolor="#d1ecf1" style="background-color: #d1ecf1; margin-bottom: 10px;">
                    <tr>
                        <td style="padding: 10px 15px; color: #0c5460; font-size: 13px;">
                            The Resident (R) course was added automatically to allow recording of resident teaching effort. If left with 0 effort and verified, it will be automatically removed.
                        </td>
                    </tr>
                </table>
            }
            <table class="data-table section" cellpadding="0" cellspacing="0" border="1" bordercolor="#dee2e6" width="100%" style="border: 1px solid #dee2e6; border-collapse: collapse;">
                <tr bgcolor="#022851" style="background-color: #022851;">
                    <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Course</th>
                    <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Units</th>
                    <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Enrollment</th>
                    <th align="left" style="padding: 10px; color: #ffffff; font-size: 13px;">Role</th>
                </tr>
                @foreach (var course in Model.Courses.Where(c => c.IsRCourse))
                {
                    <tr bgcolor="#f8f9fa" style="background-color: #f8f9fa;">
                        <td style="padding: 10px; border-bottom: 1px solid #dee2e6; font-weight: bold;">@course.CourseCode</td>
                        <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">@course.Units units</td>
                        <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">@course.Enrollment</td>
                        <td style="padding: 10px; border-bottom: 1px solid #dee2e6;">@course.Role</td>
                    </tr>
                    @foreach (var item in course.EffortItems)
                    {
                        <tr @(item.IsZero ? "bgcolor=\"#f8d7da\" style=\"background-color: #f8d7da;\"" : "")>
                            <td colspan="4" style="padding: 8px 10px 8px 30px; border-bottom: 1px solid #dee2e6;@(item.IsZero ? " color: #721c24; font-weight: bold;" : "")">
                                @item.EffortType = @item.Value
                                @if (item.IsZero)
                                {
                                    <span style="color: #721c24;">*** ZERO @item.Unit ***</span>
                                }
                                else
                                {
                                    @item.Unit
                                }
                            </td>
                        </tr>
                    }
                }
            </table>
        </td>
    </tr>
}

@* Child Courses Section *@
@if (Model.ChildCourses.Any())
{
    <tr>
        <td class="email-content section" style="padding: 20px;">
            <h3 style="margin: 0; padding: 0 0 10px 0; color: #022851; font-size: 16px;">Cross Listed / Sectioned Courses</h3>
            <ul style="margin: 0; padding: 0 0 0 20px; color: #333333;">
                @foreach (var child in Model.ChildCourses)
                {
                    <li>@child.CourseCode - @child.RelationshipType</li>
                }
            </ul>
        </td>
    </tr>
}

@* Action Section *@
@if (Model.HasZeroEffort)
{
    <tr>
        <td class="email-content section" bgcolor="#fff3cd" style="padding: 20px; background-color: #fff3cd; border-left: 4px solid #ffc107;">
            <p style="margin: 0; padding: 0 0 10px 0; color: #856404; font-weight: bold;">Action Required</p>
            <p style="margin: 0; padding: 0 0 10px 0; color: #856404;">You have one or more effort items documented as ZERO effort. You will not be able to verify your effort until these items have been updated to document hours or weeks or are removed. Please work with your department admin to resolve these issues.</p>
            <p style="margin: 0; padding: 0;">
                <a href="@Model.VerificationUrl" style="color: #022851;">View your effort in the system</a>
            </p>
        </td>
    </tr>
}
else
{
    <tr>
        <td class="email-content section" align="center" style="padding: 20px;">
            <p style="margin: 0; padding: 0 0 15px 0;">If this effort is accurate, please verify it:</p>
            @* Use table-based button for maximum Outlook compatibility *@
            <table cellpadding="0" cellspacing="0" border="0" align="center">
                <tr>
                    <td bgcolor="#022851" style="background-color: #022851; padding: 12px 24px;">
                        <a href="@Model.VerificationUrl" style="color: #ffffff; font-weight: bold; text-decoration: none;">Verify My Effort</a>
                    </td>
                </tr>
            </table>
            <p class="section" style="margin: 0; padding: 15px 0 0 0; font-size: 13px; color: #666666;">If there are inaccuracies, please reply to this message with corrections.</p>
        </td>
    </tr>
}
} @* End of else block for HasNoRecords *@

@* Footer Notes (shown for all cases) *@
<tr>
    <td class="email-content section" style="padding: 20px; border-top: 1px solid #dee2e6; font-size: 12px; color: #666666;">
        <p style="margin: 0; padding: 0 0 10px 0;"><strong>Please note:</strong> Guest lectures in graduate courses during quarter terms are not automatically imported. You will need to report this effort to your department to receive credit for it.</p>
        <p class="section" style="margin: 0; padding: 0;">Teaching is an important component of your faculty appointment and if effort is omitted it may have a negative effect on the overall teaching averages. It is important for all faculty to verify their effort each term.</p>
    </td>
</tr>
